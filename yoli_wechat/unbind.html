<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <meta name='apple-mobile-web-app-capable' content='yes' />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta name="renderer" content="webkit" />
    <title>当前状态</title>
    <link rel="stylesheet" type="text/css" href="lib/css/reset.css">
    <link rel="stylesheet" type="text/css" href="css/kh_public.css">
    <link rel="stylesheet" type="text/css" href="css/dqztcss.css">
</head>

<body>
    <div class="now_state">
        <div class="user_face">
            <img src="img/face_img01.png" alt="">
        </div>
        <div class="round_xz">
            <div class="max_img">
                <img src="img/max_round_img.png" alt="">
            </div>
            <div class="xuanz">
                <img src="img/saomiao_img.png" alt="">
            </div>
            <div class="wenz">昨夜睡眠</div>
        </div>
        <div class="bandi_btn" onclick="_onclik()">
            绑定设备
        </div>
        <div class="band_sueess" hidden>
            <div class="jaince">
                <div class="left">
                    <div class="huxi">呼吸正常</div>
                    <div class="txt">30</div>
                </div>
                <div class="right">
                    <div class="xint">心跳正常</div>
                    <div class="txt">80</div>
                </div>
                <div class="clear"></div>
            </div>
            <div class="tishi">今晚记得要早点睡呦！</div>
        </div>
    </div>
    <!--公共弹窗-->
    <!-- <div class="mask-wrapper">
    <div class="mask-content">
        <img class="loadingImg" src="img/loading.gif" alt="loadingImg" >
        <p class="text">正在连接设备...</p>
    </div>
</div> -->
    <script type="text/javascript" src="lib/js/jquery-1.9.1.min.js"></script>
    <!-- 弹窗插件 -->
    <script type="text/javascript" src="lib/js/public/zkzk_mask_box.js"></script>
    <script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script>
    window.onload = function() {
        if (document.body.scrollWidth >= 600) {
            $("body").html('<h1 style="display:block;margin:200px margin;text-align:center">请使用手机浏览器打开本页面</h1>');
            alert("请使用手机浏览器打开本页面");
        } else {
            $(".wenz").show();
            domInit();

            //向服务器获取微信扫描二维码权限所需要的配置信息;
            // $.ajax({
            //     type: 'post', //请求方式;
            //     url: 'https://www.intellihealth.cn/wx/jssdk-config', //请求的url;jssdk-config
            //     data: { //请求参数;

            //     },
            //     cache: false,       //不使用缓存
            //     dataType: 'json', //响应数据格式;
            //     success: function(data) {
            //         if (data.code == 66666) {
            //             //进行微信二维码扫描授权;
            //             wx.config({
            //                 debug: data.debug,
            //                 appId: data.appId,
            //                 timestamp: data.timestamp,
            //                 nonceStr: data.nonceStr,
            //                 signature: data.signature,
            //                 jsApiList: [data.jsApiList]
            //             });
            //         }
            //     },
            //     error: function(XMLHttpRequest, textStatus, errorThrown) {
            //         // alert(XMLHttpRequest.status);
            //         // alert(XMLHttpRequest.readyState);
            //         // alert(textStatus);
            //     }
            // });
        }
    }

    /* 初始化样式 */
    function domInit() {
        /* 自动获取高度 */
        function _auto_height(classnane) {
            var widt = classnane.width(); //获取该模块的高度
            classnane.height(widt);
        };
        // _auto_height($('.user_face'));
        _auto_height($('.round_xz'));
        _auto_height($('.xuanz'));
        _auto_height($('.wenz'));
        /*
         *获取定位
         * */
        function _left_top(classnane) {
            var widt = classnane.width() / 2; //获取该模块的高度
            classnane.css({
                'margin-left': -widt,
                'margin-top': -widt,
                'line-height': widt * 2 + 'px'
            });
        }
        _left_top($('.wenz'));
        /*
         * 检测浮动元素的位置
         * */
        function _fudong(classnane, ceshi) {
            var widt = ceshi.width() / 2; //获取该模块的高度
            var hei = ceshi.width() / 7;
            classnane.css({
                'top': widt + hei + 20
            });
        }
        _fudong($('.sleep_yestday>.top>.fudong'), $('.sleep_yestday>.top>.max_yuan'));
    }

    //微信二维码扫描授权通过回调函数;
    wx.ready(function() {
        $('#result').html('授权通过');
        $('#bindBtn').click(function() {
            wx.scanQRCode({
                needResult: 1, //默认为0，扫描结果由微信处理，1则直接返回扫描结果，
                scanType: ["qrCode"], //指定扫二维码
                success: function(res) {
                    //如果扫码成功, 则请求绑定设备;
                    bindDevice(res.resultStr);
                }
            });
        });
    });
    //权限获取失败;
    wx.error(function(res) {
        // $('#result').append(res+"<br/>");
        // alert(res);
    });

    function bindDevice(deviceCode) {
        $('#result').html(deviceCode);
        $.ajax({
            type: 'post', //请求方式;
            url: 'bind', //请求的url;
            data: { //请求参数;
                code: deviceCode
            },
            cache: false,
            dataType: 'json', //响应数据格式;
            success: function(data) {
                if (data.code == 66666) {
                    $('#result').html("授权通过: " + data.msg);
                }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                // alert(XMLHttpRequest.status);
                // alert(XMLHttpRequest.readyState);
                // alert(textStatus);
            }
        });
    }
    /* 点击绑定设备按钮 */
    function _onclik() {
        window.location.href = "bind.html"
    }
    </script>
</body>

</html>
